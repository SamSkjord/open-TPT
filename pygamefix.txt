‚úÖ Summary: Making Pygame with KMSDRM work on Pi (Bookworm Lite, no X)

‚∏ª

‚öôÔ∏è Goal:

Run pygame fullscreen on boot via systemd, using the KMSDRM backend (no X, no login, straight to HDMI).

‚∏ª

üîß 1. Fix system-wide Python package handling
	‚Ä¢	pip3 install ... often installs to user site-packages ‚Üí invisible to systemd
	‚Ä¢	We fixed this by always using:

sudo /usr/bin/python3 -m pip install ... --break-system-packages


‚∏ª

üîß 2. Fix DNS (twice)
	‚Ä¢	Pi‚Äôs /etc/resolv.conf was broken/reset
	‚Ä¢	You set:

nameserver 1.1.1.1
nameserver 8.8.8.8

	‚Ä¢	Optionally locked with sudo chattr +i /etc/resolv.conf

‚∏ª

üß± 3. Recompiled SDL2 (not SDL3!) with KMSDRM
	‚Ä¢	You originally cloned main (SDL3) ‚Äî incompatible with pygame
	‚Ä¢	We fixed it by using:

git clone --branch release-2.28.5 https://github.com/libsdl-org/SDL.git

	‚Ä¢	Then built with:

cmake .. -DSDL_VIDEO_DRIVER_KMSDRM=ON -DCMAKE_BUILD_TYPE=Release
make -j4
sudo make install
sudo ldconfig


‚∏ª

üß± 4. Rebuilt pygame from source

After installing correct SDL2:

sudo /usr/bin/python3 -m pip install pygame --no-binary :all: --break-system-packages


‚∏ª

üî° 5. Font module was still missing

Cause: SDL_ttf wasn‚Äôt present before building pygame.

Fix:

# build SDL_ttf
git clone --branch release-2.20.2 https://github.com/libsdl-org/SDL_ttf.git
cd SDL_ttf && mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
sudo make install
sudo ldconfig

# then rebuild pygame again
sudo /usr/bin/python3 -m pip uninstall pygame -y
sudo /usr/bin/python3 -m pip install pygame --no-binary :all: --break-system-packages


‚∏ª

üßº 6. Systemd service tweaks

Your /etc/systemd/system/openTPT.service should include:

[Service]
ExecStart=/usr/bin/python3 /home/pi/open-TPT/main.py
WorkingDirectory=/home/pi/open-TPT
User=pi
Environment=SDL_VIDEODRIVER=KMSDRM
Environment=PYGAME_HIDE_SUPPORT_PROMPT=1
Environment=LD_LIBRARY_PATH=/usr/local/lib
StandardOutput=journal
Restart=always

Then:

sudo systemctl daemon-reload
sudo systemctl enable openTPT.service
sudo systemctl start openTPT.service


‚∏ª

‚úÖ Now:
	‚Ä¢	Boots to HDMI using KMSDRM (no X)
	‚Ä¢	Pygame works fullscreen
	‚Ä¢	Fonts render correctly
	‚Ä¢	Service runs without login

Done.